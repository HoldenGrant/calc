<!DOCTYPE html>
<html>
<head>
	<!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Client Cal</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
	<style>
		.form-group label {
		    font-size: 15px;
		}
		.modal-lg {
		    max-width: 1200px;
		}
		.small-font{
			font-size: 12px;
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="row">
			<div class="col-sm-12">
				<form id="form-calc">
					<div class="row">
						<div class="form-group p-2"">
							<label>Your Name</label>
							<input id="client-name" class="form-control" value="John Doe">
						</div>
						<!-- 1 -->
						<div class="form-group p-2"">
							<label>Online ads</label>
							<select id="ol-ads" class="form-control">
								<option value="No Ads"></option>
								<option value="Google AdWords">Google AdWords</option>
								<option class="Facebook">Facebook</option>
							</select>
						</div>
						<!-- 9 -->
						<div class="form-group p-2"">
							<label>What is their target CPA (cost to acquire a new client)</label>
							<input id="ttl-cpa" class="form-control" value="1,000">
						</div>
					</div>
					<!-- <input id="num" type="text" />
					<input type="button" id="btnformat" value="Format Number" /> -->
					<div class="row input-fields">
						
						<!-- 2 -->
						<div class="form-group p-2"">
							<label>Total monthly advertising spent</label>
							<input id="ttl-monthly" class="form-control" value="10,000">
						</div>
						<!-- 3 -->
						<div class="form-group p-2"">
							<label>Total number of impressions during this period</label>
							<input id="ttl-imp" class="form-control" value="16,590">
						</div>
						<!-- 4 -->
						<div class="form-group p-2"">
							<label>Total number of ad clicks in a month</label>
							<input id="ttl-clck" class="form-control" value="500">
						</div>
						<!-- 5 -->
						<div class="form-group p-2"">
							<label>Total number of leads</label>
							<input id="ttl-lead" class="form-control" value="100">
						</div>
						<!-- 6 -->
						<div class="form-group p-2"">
							<label>Total number of leads contacted</label>
							<input id="ttl-lead-cont" class="form-control" value="50">
							<div class="small-font d-none ttl-lead-cont-error">
								<p>Must be less than the total number of leads</p>
							</div>
						</div>
						<!-- 7 -->
						<div class="form-group p-2"">
							<label>Total number of retainers sent out</label>
							<input id="ttl-retain" class="form-control" value="10">
						</div>
						<!-- 8 -->
						<div class="form-group p-2"">
							<label>Total number of retainers returned</label>
							<input id="ttl-ret-return" class="form-control" value="5">
							<div class="small-font d-none ttl-ret-return-error">
								<p>Must be less than the total number of retainers sent out</p>
							</div>
						</div>
					</div>
					
					<div class="row">
						<div class="col-md-6 col-sm-12">
							<button type="button" id="calc-input" class="btn btn-primary btn-lg btn-block">Submit</button>
							<!-- <button type="button" id="calc-input" class="btn btn-primary btn-lg btn-block" data-toggle="modal" data-target=".bd-example-modal-lg">Submit</button> -->
						</div>
						<div class="col-md-6 col-sm-12">
							<button type="button" class="btn btn-danger btn-lg btn-block clear-data">Clear</button>
						</div>
					</div>
					

					<!-- <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
					  <div class="modal-dialog modal-lg">
					    <div class="modal-content">
					    	<div class="modal-header">
						        <h5 class="modal-title">Result</h5>
						        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
						          <span aria-hidden="true">&times;</span>
						        </button>
						    </div>
						    <div class="modal-body">
						    	<div class="container p-0">
						    		<div class="row mt-3 p-0">
										<div class=col-md-6 col-sm-12">
											<div id="calc-res-calculated"></div>
										</div>
										<div class=col-md-6 col-sm-12">
											<div id="calc-res-statement"></div>
										</div>
									</div>
						    	</div>
						    </div>
						    <div class="modal-footer">
						    	<button type="button" class="btn btn-primary">Contact Us</button>
						    	<button type="button" class="btn btn-secondary clear-data" data-dismiss="modal">Close</button>
						    </div>
					    </div>
					  </div>
					</div> -->
				</form>
			</div>
		</div>
		<div class="row mt-3 pb-5">
			<hr>
			<div class=col-md-6 col-sm-12">
				<div id="calc-res"></div>
				<div id="calc-res-calculated"></div>
			</div>
			<div class=col-md-6 col-sm-12">
				<div id="calc-res-statement"></div>
			</div>
		</div>
	</div>
</body>
</html>
<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

<script>
// 	$(function () {
//     $('#btnformat').on('click', function () {
//         var x = $('#num').val();
//         $('#num').val(addCommas(x));
//     });
// });
 
// function addCommas(x) {
//     var parts = x.toString().split(".");
//     parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
//     return parts.join(".");
// }
	
	
	$('.clear-data').on('click', function(){
		$('#calc-res, #calc-res-calculated, #calc-res-statement').empty();
	});
	$('#calc-input').on('click', function(){
		var client_name = $('#client-name').val();
		var ol_ads = $('#ol-ads').val();
		var ttl_monthly = $('#ttl-monthly').val().replace(/,/g,'');
		var ttl_imp = $('#ttl-imp').val().replace(/,/g,'');
		var ttl_clck = $('#ttl-clck').val().replace(/,/g,'');
		var ttl_lead = $('#ttl-lead').val().replace(/,/g,'');
		var ttl_lead_cont = $('#ttl-lead-cont').val().replace(/,/g,'');
		var ttl_lead_cont_dbl = parseFloat(ttl_lead_cont) * 2;
		var ttl_retain_out = $('#ttl-retain').val().replace(/,/g,'');
		var ttl_retain_return = $('#ttl-ret-return').val().replace(/,/g,'');
		var ttl_retain_return_dbl = parseFloat(ttl_retain_return) * 2;
		var ttl_cpa = parseFloat($('#ttl-cpa').val().replace(/,/g,'')).toFixed(2);

		
		if ( parseFloat(ttl_retain_return) > parseFloat(ttl_retain_out) ) {
			$('.ttl-ret-return-error').addClass('d-block');
			$('.ttl-ret-return-error').removeClass('d-none');
			
			$('#calc-res, #calc-res-calculated, #calc-res-statement').empty();
			return false;
		} else if ( parseFloat(ttl_retain_return) <= parseFloat(ttl_retain_out) ) {
			$('.ttl-ret-return-error').removeClass('d-block');
			$('.ttl-ret-return-error').addClass('d-none');
		}

		if ( parseFloat(ttl_lead_cont) > parseFloat(ttl_lead) ) {
			$('.ttl-lead-cont-error').addClass('d-block');
			$('.ttl-lead-cont-error').removeClass('d-none');
			
			$('#calc-res, #calc-res-calculated, #calc-res-statement').empty();
			return false;
		} else if ( parseFloat(ttl_lead_cont) <= parseFloat(ttl_lead) ) {
			$('.ttl-lead-cont-error').removeClass('d-block');
			$('.ttl-lead-cont-error').addClass('d-none');
		}
		


		$('#calc-res, #calc-res-calculated, #calc-res-statement').empty();
		$('#calc-res').append('<p>Advertising online: <b> ' + ol_ads + ' </b></p>');
		$('#calc-res').append('<p>Total monthly advertising spent: <b>$ <span class="num">' + parseFloat(ttl_monthly).toFixed(2) + '</span> </b></p>');
		$('#calc-res').append('<p>Total number of impressions during this period: <b> <span class="num">' + ttl_imp + '</span> </b></p>');
		$('#calc-res').append('<p>Total number of ad clicks in a month: <b> <span class="num">' + ttl_clck + '</span> </b></p>');
		$('#calc-res').append('<p>Total number of leads: <b> <span class="num">' + ttl_lead + '</span> </b></p>');
		$('#calc-res').append('<p>Total number of leads contacted: <b> <span class="num">' + ttl_lead_cont + '</span> </b></p>');
		$('#calc-res').append('<p>Total number of retainers sent out: <b> <span class="num">' + ttl_retain_out + '</span> </b></p>');
		$('#calc-res').append('<p>Total number of retainers returned: <b> <span class="num">' + ttl_retain_return + '</span> </b></p>');
		$('#calc-res').append('<p>What is their target CPA (cost to acquire a new client): <b>$ <span class="num">' + ttl_cpa + '</span> </b></p>');


		var click_rate = Math.round(( parseFloat(ttl_clck) / parseFloat(ttl_imp) ) * 100);
		var click_rate_dbl =  parseFloat(click_rate) * 2;

		var lead_con_rate = Math.round(( parseFloat(ttl_lead) / parseFloat(ttl_clck) ) * 100);
		var lead_con_rate_dbl = parseFloat(lead_con_rate) * 2;

		var cost_pr_lead = parseFloat(ttl_monthly) / parseFloat(ttl_lead);
		var cont_rate = Math.round(( parseFloat(ttl_lead_cont) / parseFloat(ttl_lead) ) * 100);
		var ratainer_ret_rate = Math.round((parseFloat(ttl_retain_return) / parseFloat(ttl_retain_out)) * 100);
		var cpa = parseFloat(ttl_monthly) / parseFloat(ttl_retain_return);
		var client_spent = Math.round(parseFloat(cpa).toFixed(2) - parseFloat(ttl_cpa).toFixed(2));
		//var client_spent_rev = Math.round(parseFloat(ttl_cpa) - parseFloat(cpa));
		var my_cpa = parseFloat(cpa).toFixed(2);
		var calc_cpa = parseFloat(ttl_cpa).toFixed(2);
		var res_cpa = my_cpa - calc_cpa;
		//alert(cont_rate);
		// alert(parseFloat(cpa).toFixed(2));
		// alert(parseFloat(ttl_cpa).toFixed(2));
		// alert(res_cpa);
		//function saveSpent(){
			

		//}
		

		$('#calc-res-calculated').append('<h3>RESULT</h3><br><p>Click-through Rate <b>' + click_rate + '%</b></p>');
		$('#calc-res-calculated').append('<p>Lead Conversation Rate <b>' + lead_con_rate + '%</b></p>');
		$('#calc-res-calculated').append('<p>Cost Per Lead <b>$<span class="num">' + cost_pr_lead + '</span></b></p>');
		$('#calc-res-calculated').append('<p>Contact Rate <b>' + cont_rate + '%</b></p>');
		$('#calc-res-calculated').append('<p>Retainer Return Rate <b>' + ratainer_ret_rate + '%</b></p>');
		$('#calc-res-calculated').append('<p>Cost Per New Client or CPA <b>$<span class="num">' + parseFloat(cpa).toFixed(2) + '</span></b></p>');
		
		if( parseFloat(cpa) > parseFloat(ttl_cpa) ) {
			//var save = "spent";
			$('#calc-res-calculated').append('<p>In the scenario above, the CPA is <b>$<span class="num">' + parseFloat(cpa).toFixed(2) + '</span></b> and the target CPA they want to hit is <b>$<span class="num">' + parseFloat(ttl_cpa).toFixed(2)  + '</span></b>. Which means they spent <b>$<span class="num">' +  parseFloat(res_cpa).toFixed(2) + '</span></b> more.</p>');

		}else if( parseFloat(cpa) <= parseFloat(ttl_cpa) ) {
			//var spent = "save"
			$('#calc-res-calculated').append('<p>In the scenario above, the CPA is <b>$<span class="num">' + parseFloat(cpa).toFixed(2) + '</span></b> and the target CPA they want to hit is <b>$<span class="num">' + parseFloat(ttl_cpa).toFixed(2)  + '</span></b>. Which means they save <b>$<span class="num">' + Math.abs(parseFloat(res_cpa).toFixed(2))  + '</span></b> more.</p>');
		}

		

		if( parseFloat(cpa) > parseFloat(ttl_cpa) ) {
			//alert("test");
			$('#calc-res-statement').append('<p> Hi <b>' + client_name + '</b>, it looks like you are spending <b>$<span class="num">' + parseFloat(res_cpa).toFixed(2) + '</span></b> more than what you want to pay to acquire a new client. Based on the numbers you enterred, your current CPA is <b>$<span class="num">' + parseFloat(cpa).toFixed(2) + '</span></b> and you only want to spend a maximum of <b>$<span class="num">' + parseFloat(ttl_cpa).toFixed(2) + '</span>.</p>');
			$('#calc-res-statement').append('<p>To hit your goal of <b>$<span class="num">' + parseFloat(ttl_cpa).toFixed(2) + '</span> </b> for each new client you need to:</p>');
			$('#calc-res-statement').append('<p>- increase your CTR to <b>' + click_rate_dbl + '%</b> from <b>' + click_rate + '%</b>, or</p>');
			$('#calc-res-statement').append('<p>- increase your lead converation rate to <b>' + lead_con_rate_dbl + '%</b> from <b>' + lead_con_rate + '%</b>, or</p>');
			$('#calc-res-statement').append('<p>- succesfully contact <b>' + ttl_lead_cont_dbl + '</b> instead of <b>' + ttl_lead_cont + '</b></p>');
			$('#calc-res-statement').append('<p>- increase returned retainers to  <b>' + ttl_retain_return_dbl + '</b> from <b>' + ttl_retain_return + '</b></p>');
			$('#calc-res-statement').append('<p>Assuming your pipeline variables stay constant, small improvements of any of the key metrics above will contribute to meeting your target CPA.</p><p>If you would like to a customized plan on meeting your CPA, please contact us through the form below. (then show a form for them to use)</p>');
		} else if( parseFloat(cpa) <= parseFloat(ttl_cpa) ) {
			//alert("tset");
			$('#calc-res-statement').append('<p>Great work, <b>' + client_name + '</b>! It looks like you are doing a great job with your campaign. You can get even more clients by increasing your monthly ad budget. Assuming your pipeline variables stay constant, small improvements of any of the key metrics above will contribute to meeting your target CPA.</p>');
			$('#calc-res-statement').append('<p>If you would like to a customized plan on scaling campaigns and getting more clients, please contact us through the form below. (then show a form for them to use)</p>');
			$('#calc-res-statement').append('<p>We can setup a formula on excel spreadsheet for this, which automatically caclulates the figures described above.</p>');
			$('#calc-res-statement').append('<p>The end goal is to help them see what aspect of their sales-marketing pipeline needs fixing, and we can fix it for them to help them meet their CPA target.</p>');
			$('#calc-res-statement').append('<p>Please let me know if you have questions. We can brainstorm this further.</p>');
		}

		$.fn.digits = function(){ 
			return this.each(function(){ 
				$(this).text( $(this).text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,") ); 
			})
		}
		$("span.num").digits();

	});
</script>